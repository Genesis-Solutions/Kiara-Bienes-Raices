<%- include('partials/head') %>

<body style="font-family: 'Montserrat', sans-serif">

    <%- include('partials/navbar') %>

    <!-- Pictures Form -->

    <div class="px-10 py-5 grid grid-cols-3">
        <!-- <div class="col-span-2">
            <h2 class="text-lg font-semibold">
                Imagen Principal
            </h2> -->

            <!-- Main Picture Form -->

            <!-- <form id="imagenPrincipal" name="imagenPrincipal" action="/dashboard/alta/inmueble/imagenPrincipal/<%=idInmueble%>" method="POST" enctype="multipart/form-data">
                <div class="flex items-center text-center justify-center w-full p-4">
                    <label for="dropzone-file" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                        <div class="flex flex-col items-center justify-center pt-8 pb-5">
                            <i class="fa-solid fa-cloud-arrow-up fa-2xl text-gray-500"></i>
                            <br>
                            <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Selecciona</span> la imagen principal del inmueble.</p>
                            <p class="text-xs text-gray-500">PNG, JPG o JPEG</p>
                        </div>
                        <input id="mainPhoto" name="mainPhoto" type="file" class="hidden"/> // Esto ya estaba comentado
                        <input id="mainPhoto" name="mainPhoto" type="file"/>
                    </label>
                </div>
            </form> -->

        <!-- </div> -->
        <div class="col-span-3">
            <h2 class="text-lg font-semibold">
                Imágenes del inmueble
            </h2>

            <!-- Secundary Pictures Form -->

            <form action="/dashboard/alta/inmueble/imagenesSecundarias/<%=idInmueble%>" id="imagenesSecundarias" name="imagenesSecundarias"
                enctype="multipart/form-data" method="POST">
                <div class="dropzone dz-clickable" id="uploadDropzone">
                    <div class="dz-default dz-message" data-dz-message="">
                        <span>Drop files here to upload</span>
                    </div>
                </div>
                <br />
            </form>

        </div>
    </div>

    <!-- Information Form -->

    <!-- Cambiar dependiendo del id del tipo de inmueble (categoria es el idCategoria) -->
    <% if(categoria == 1 || categoria == 2){ %>
        <%- include('partials/formsInmuebles/casaDepartamento', {idInmueble: idInmueble, idRol:idRol, idusuario:idUsuario, listaAgentes:listaAgentes}) %>
    <% } else if (categoria == 3){ %>
        <%- include('partials/formsInmuebles/local', {idInmueble: idInmueble, idRol:idRol, idusuario:idUsuario, listaAgentes:listaAgentes}) %>        
    <% } else if (categoria == 4){ %>
        <%- include('partials/formsInmuebles/terreno', {idInmueble: idInmueble, idRol:idRol, idusuario:idUsuario, listaAgentes:listaAgentes}) %>       
    <% } else if (categoria == 5){ %>
        <%- include('partials/formsInmuebles/bodega', {idInmueble: idInmueble, idRol:idRol, idusuario:idUsuario, listaAgentes:listaAgentes}) %>
    <% } else if (categoria == 6){ %>
        <%- include('partials/formsInmuebles/oficina', {idInmueble: idInmueble, idRol:idRol, idusuario:idUsuario, listaAgentes:listaAgentes}) %>
    <% } else if (categoria == 7){ %>
        <%- include('partials/formsInmuebles/otro', {idInmueble: idInmueble, idRol:idRol, idusuario:idUsuario, listaAgentes:listaAgentes}) %>
    <%}%>

    <!-- Buttons Section -->

    <div class="px-10 pb-12 flex justify-evenly">
        <input type="hidden" id="id_inmueble" name="id_inmueble" value="<%=idInmueble%>">
        <button type="submit" class="px-5 py-2 w-1/3 rounded-lg text-base text-white font-medium bg-red-600 hover:font-medium hover:bg-red-700 btnCancelar">
            Cancelar
        </button>
        <button class="px-5 py-2 w-1/3 rounded-lg text-base text-white font-medium bg-gray-800 hover:font-medium hover:bg-gray-700 btnSubmit">
            Registrar
        </button>
    </div>

    <form id="deleteInmueble" action="/dashboard/baja/inmueble/<%=idInmueble%>" method="POST" hidden>
        <input type="hidden" id="id_inmueble" name="id_inmueble" value="<%=idInmueble%>">
    </form>

    <!-- Enlazar con la biblioteca de jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <!-- jQuery form plug in -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 
    <script src="https://malsup.github.io/jquery.form.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.2/locale/es.js"></script>
    <!-- Enlazar con la biblioteca de Dropzone -->
    <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.js"></script>

    <script>
        function enviarFormulario(e){
            e.preventDefault();
        }
    </script>

    <script type="text/javascript">   
        $(document).on("click", ".btnSubmit", function(){	
            $('#cuerpoInmueble').submit();
        })
    </script>

    <script type="text/javascript">   
        $(document).on("click", ".btnCancelar", function(){	
            eliminarInmueble();
        })
    </script>

    <script type="text/javascript">   
        function eliminarInmueble() {
            var idInmueble = $("#id_inmueble").val();
            console.log("Hola desde el boton de eliminar");
            console.log("idInmueble",idInmueble);
            $.ajax({
                url: '/dashboard/baja/inmueble/<%=idInmueble%>',
                type: 'GET',
                dataType: 'json',
                success: function() {
                    console.log("On succes desde el eliminar");
                    window.location.replace('/dashboard/alta');
                }
            });
        }
    </script>

    <script>
        $('#cuerpoInmueble').submit(function(e) {
            e.preventDefault();
            console.log("Submit de cuerpoInmueble");
            $.ajax({
                url: $(this).attr('action'),
                type: 'POST',
                data: $( this ).serializeArray(),
                success: function() {
                    console.log("Dentro del succes de form 1");
                    $('#imagenesSecundarias').submit();
                    $('#imagenesSecundarias').submit(function(e) {
                        e.preventDefault();
                        console.log("Submit de fotosSecundarias");
                        $.ajax({
                            url: $(this).attr('action'),
                            type: 'POST',
                            data: new FormData(this),
                            processData: false,
                            contentType: false,
                            success: function() {
                                console.log("Dentro del succes de form 2");
                                window.location.replace('/dashboard/alta');
                            }
                        })
                    });
                }
            })
        });
    </script>

        <!-- Configuración de dropzone -->
        <script type="text/javascript">
            Dropzone.autoDiscover = false;
            function paramNameForSend() {
                return "media";
            }
            var idInmueble = $("#id_inmueble").val();
            //console.log("Dentro de la config de dropzone, idInmueble = ",idInmueble);
            $("#uploadDropzone").dropzone({ 
                url: '/dashboard/alta/inmueble/imagenesSecundarias/<%=idInmueble%>',
                maxFilesize: 15, // MB
                maxFiles: 25,
                autoProcessQueue: false,
                uploadMultiple: true,
                paramName: paramNameForSend,
                method: 'post',
                parallelUploads: 25,
                init: function() {
                    var myDropzone = this;
                    $("#imagenesSecundarias").submit(function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        myDropzone.processQueue();
                    }); 
                }
            });
        </script>

    <script type="text/javascript">
        $(document).ready(function(){
            $('.form-checkbox').change(function(){
                if($(this).is(':checked')){
                    $('.form-checkbox').not(this).prop('disabled',true);
                } else{
                    $('.form-checkbox').prop('disabled',false);
                }
            });
        });
    </script>

    <%- include("partials/footer") %>

</body>
</html>